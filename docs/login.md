# 카카오 로그인 메뉴얼

## 카카오톡 인앱브라우저에서 쿠키값 구하기
### 안드로이드
1. 잔여백신 페이지에 접근해서 백신 예약 신청내역 페이지에 한 번 접근합니다.
2. 나와의 채팅 또는 기타 다른 채팅방에 https://vaccine.kakao.com/api/v1/user 입력 후 눌러서 인앱브라우저로 들어갑니다. 본인이 정보가 정상적으로 표시되면 계속 진행합니다. 정상적으로 표시되지 않는 경우, https://accounts.kakao.com/login?continue=https%3A%2F%2Fvaccine.kakao.com%2Fapi%2Fv1%2Fuser 링크로 다시 시도해봅니다.  
3. 만일 그래도 정상적으로 이름이 노출되지 않고 `error`라는 단어가 보이면, `카카오 뷰`의 `잔여백신`에 접근하신 후 `신청내역` 또는 `지도상에 표시된 병원`을 눌러 준 후 다시 `나와의 채팅`으로 돌아가 적어놓은 링크를 눌러봅니다.
4. URL(링크) 입력 부분에 이 코드를 붙여넣습니다.

`javascript:document.write(document.cookie.split('_kavacto=')%5B1%5D.split(';')%5B0%5D)`

4. 페이지에 나타나는 기다란 문자를 처음부터 끝까지 복사해서 저장합니다. 이게 본인의 로그인 쿠키(토큰)입니다.
5. 매크로를 실행하면 쿠키 값을 입력하라고 뜨면, 방금 확인한 쿠키를 붙여넣습니다.

### 아이폰
1. [이 Shortcuts(단축어)](https://www.icloud.com/shortcuts/2c447895ed564692974ef5c20de4ae8e)를 저장합니다.
2. 잔여백신 페이지에 접근해서 백신 예약 신청내역 페이지에 한 번 접근합니다.
3. 나와의 채팅 또는 기타 다른 채팅방에 https://vaccine.kakao.com/api/v1/user 입력 후 눌러서 인앱브라우저로 들어갑니다. 본인이 정보가 정상적으로 표시되면 계속 진행합니다. 정상적으로 표시되지 않는 경우, https://accounts.kakao.com/login?continue=https%3A%2F%2Fvaccine.kakao.com%2Fapi%2Fv1%2Fuser 링크로 다시 시도해봅니다.  
4. 만일 그래도 정상적으로 이름이 노출되지 않고 `error`라는 단어가 보이면, `카카오 뷰`의 `잔여백신`에 접근하신 후 `신청내역` 또는 `지도상에 표시된 병원`을 눌러 준 후 다시 `나와의 채팅`으로 돌아가 적어놓은 링크를 눌러봅니다.
5. 공유 버튼을 눌러 나타나는 `잔여백신 쿠키 추출` 또는 원하신 이름으로 변경한 단축어의 버튼을 클릭합니다.
6. 페이지에 나타나는 기다란 문자를 처음부터 끝까지 복사해서 저장합니다. 이게 본인의 로그인 쿠키(토큰)입니다.
7. 매크로를 실행하면 쿠키 값을 입력하라고 뜨면, 방금 확인한 쿠키를 붙여넣습니다.

## MITMProxy 등을 이용하기
우선 Mac 사용자 기준으로 설명드립니다. Windows도 거의 동일한 방법으로 가능합니다.

이미 mitmproy를 사용해본 적이 있다면, 11번으로 건너뛰시면 됩니다.

우선 나와의 채팅 또는 기타 다른 채팅방에 https://vaccine-map.kakao.com/map2?v=1 링크를 입력해둡니다.

1. 맥이랑 아이폰을 같은 네트워크에 연결합니다.
2. `mitmproxy`를 설치합니다. https://mitmproxy.org
3. 터미널에서 `mitmweb --ssl-insecure` 커멘드를 실행합니다.
4. 브라우저가 열리면 이제 컴퓨터의 IP주소를 확인합니다. `옵션 키`를 누른 상태로 `Wifi 목록`을 누르거나, `설정 > 네트워크`에서 확인할 수 있습니다.
5. 아이폰에 들어가서 `설정 > Wi-Fi > 연결한 네트워크 옆에 i 아이콘 > 하단 프록시 설정`에 들어가서 `수동`으로 설정을 바꾸어 주시고 `서버`에 컴퓨터의 IP주소를, `포트`에 8080을 입력합니다.
6. 저장을 눌러서 설정을 저장합니다.
7. http://mitm.it 에 들어가서 iOS를 찾고, `Get mitmproxy-ca-cert.pem` 버튼을 누릅니다.
8. 다시 설정 앱으로 들어갑니다.
9. `새로운 프로파일 다운로드됨` 버튼을 눌러 프로파일을 설치합니다.
10. `설정 > General > About > 인증서 신뢰 설정`에 들어가서 `mitmproxy`를 킵니다.
11. 카카오톡에 들어가서, 처음에 입력해둔 채팅방으로 들어가서 백신지도를 킵니다.
12. 병원을 아무곳이나 클릭합니다.
13. 컴퓨터에서 아까 3번 단계에서 열린 브라우저로 들어갑니다. 혹시 닫으셨다면 http://127.0.0.1:8081 을 브라우저로 들어간 후 11번부터 다시 합니다.
14. 브라우저에서 스크롤하며 찾다보면 `https://vaccine-map.kakao.com/detail/`로 시작하는 사이트 기록이 보일겁니다. 클릭하면 우측에 해당 사이트의 기록이 뜹니다.
15. Cookie 부분을 보다보면 처음 시작부분이 `_kavacto=`로 시작하는게 보일겁니다. **해당 부분에서 `_kavacto=`을 제외한 부분이** 본인의 인증 쿠키입니다.
16. 매크로를 실행하면 쿠키 값을 입력하라고 뜨면, 방금 확인한 쿠키를 붙여넣습니다.
